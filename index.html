<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>SipCal – Alcohol Calorie Estimator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta
    name="description"
    content="SipCal estimates calories in wine, beer, and spirits from ABV, volume, and style."
  />
  <style>
    * { box-sizing: border-box; }

    :root {
      --bg: #050713;
      --bg-card: #0e111f;
      --bg-soft: #101425;
      --text: #f5f5f7;
      --muted: rgba(245, 245, 247, 0.7);
      --border-subtle: rgba(255, 255, 255, 0.06);
      --border-strong: rgba(255, 255, 255, 0.12);
      --accent: #7fd1ff;
      --accent-strong: #50e3c2;
      --danger: #ff6b6b;
      --radius-lg: 18px;
      --radius-full: 999px;
      --shadow-card: 0 18px 40px rgba(0, 0, 0, 0.6);
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        sans-serif;
      background: radial-gradient(circle at top, #141832 0, #050713 40%, #020308 100%);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    header {
      padding: 1.2rem 1.5rem 0.6rem;
      border-bottom: 1px solid var(--border-subtle);
    }

    .header-inner {
      max-width: 1040px;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.55rem;
    }

    .brand-row {
      display: flex;
      align-items: center;
      gap: 0.6rem;
    }

    .logo-circle {
      width: 34px;
      height: 34px;
      border-radius: 50%;
      background: radial-gradient(circle at 25% 0%, #e4f4ff, #3a7dff, #050816);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.9rem;
      font-weight: 700;
      color: #050816;
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.55);
    }

    header h1 {
      margin: 0;
      font-size: 1.7rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
    }

    header p {
      margin: 0;
      font-size: 0.9rem;
      color: var(--muted);
      text-align: center;
    }

    .pill {
      font-size: 0.78rem;
      color: rgba(245, 245, 247, 0.7);
    }

    .pill span {
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      border-radius: 999px;
      border: 1px solid var(--border-subtle);
      padding: 0.2rem 0.7rem;
      background: rgba(0, 0, 0, 0.25);
      backdrop-filter: blur(6px);
    }

    main {
      flex: 1;
      padding: 1.6rem 1.5rem 2.2rem;
    }

    .main-inner {
      max-width: 1040px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: minmax(0, 1.15fr) minmax(0, 1fr);
      gap: 1.5rem;
    }

    @media (max-width: 820px) {
      .main-inner {
        grid-template-columns: 1fr;
      }
    }

    .panel {
      border-radius: var(--radius-lg);
      border: 1px solid var(--border-subtle);
      background: linear-gradient(
          135deg,
          rgba(80, 227, 194, 0.04),
          rgba(120, 169, 255, 0.1)
        ),
        var(--bg-card);
      box-shadow: var(--shadow-card);
      padding: 1.4rem 1.35rem 1.3rem;
    }

    .panel--text {
      background: radial-gradient(circle at top left, #181b32, #050713);
    }

    .panel h2 {
      margin: 0 0 0.45rem;
      font-size: 1.3rem;
    }

    .panel p {
      margin: 0;
      font-size: 0.9rem;
      color: var(--muted);
    }

    .hero-list {
      margin-top: 0.9rem;
      display: grid;
      gap: 0.55rem;
      font-size: 0.86rem;
    }

    .hero-item {
      display: flex;
      gap: 0.5rem;
      align-items: flex-start;
    }

    .hero-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: var(--accent-strong);
      margin-top: 0.4rem;
    }

    .hero-footnote {
      margin-top: 0.9rem;
      font-size: 0.8rem;
      color: rgba(245, 245, 247, 0.65);
    }

    .panel-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 0.4rem;
      margin-bottom: 0.8rem;
    }

    .panel-header h3 {
      margin: 0;
      font-size: 1.15rem;
    }

    .badge {
      font-size: 0.75rem;
      padding: 0.21rem 0.6rem;
      border-radius: 999px;
      border: 1px solid rgba(80, 227, 194, 0.6);
      background: rgba(80, 227, 194, 0.08);
      color: rgba(211, 249, 237, 0.95);
    }

    label {
      display: block;
      margin-top: 0.7rem;
      margin-bottom: 0.25rem;
      font-size: 0.86rem;
      color: rgba(245, 245, 247, 0.88);
    }

    .field-row {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 0.65rem;
    }

    input, select {
      width: 100%;
      padding: 0.58rem 0.7rem;
      border-radius: 10px;
      border: 1px solid var(--border-strong);
      background: var(--bg-soft);
      color: var(--text);
      font-size: 0.92rem;
      outline: none;
      appearance: none;
    }

    input::placeholder {
      color: rgba(245, 245, 247, 0.35);
    }

    input:focus, select:focus {
      border-color: rgba(120, 188, 255, 0.95);
      box-shadow: 0 0 0 1px rgba(120, 188, 255, 0.45);
    }

    .btn-primary {
      margin-top: 1rem;
      width: 100%;
      padding: 0.72rem 0.7rem;
      border-radius: var(--radius-full);
      border: none;
      font-size: 0.96rem;
      font-weight: 600;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      background: linear-gradient(135deg, var(--accent-strong), var(--accent));
      color: #050816;
      cursor: pointer;
    }

    .btn-primary:active {
      transform: translateY(1px);
      filter: brightness(0.97);
    }

    .btn-secondary {
      padding: 0.48rem 0.85rem;
      border-radius: var(--radius-full);
      border: 1px solid var(--border-strong);
      background: rgba(0, 0, 0, 0.25);
      color: var(--text);
      font-size: 0.8rem;
      font-weight: 500;
      cursor: pointer;
      white-space: nowrap;
    }

    .btn-secondary:active {
      transform: translateY(1px);
    }

    .lookup-row {
      display: grid;
      grid-template-columns: minmax(0, 1.6fr) auto;
      gap: 0.6rem;
      align-items: center;
    }

    .lookup-note {
      margin-top: 0.25rem;
      font-size: 0.75rem;
      color: rgba(245, 245, 247, 0.6);
    }

    .lookup-note span {
      color: var(--accent);
    }

    .results {
      margin-top: 1.05rem;
      padding: 0.9rem;
      border-radius: 12px;
      background: rgba(0, 0, 0, 0.4);
      border: 1px solid var(--border-subtle);
      font-size: 0.92rem;
    }

    .results h4 {
      margin: 0 0 0.4rem;
      font-size: 1rem;
    }

    .results p {
      margin: 0.12rem 0;
    }

    .results .tagline {
      margin-top: 0.45rem;
      font-size: 0.8rem;
      color: rgba(245, 245, 247, 0.65);
    }

    .hint {
      margin-top: 0.5rem;
      font-size: 0.78rem;
      color: rgba(245, 245, 247, 0.62);
    }

    .hint span {
      color: var(--danger);
    }

    footer {
      text-align: center;
      padding: 0.9rem 1rem 1.4rem;
      font-size: 0.78rem;
      color: rgba(245, 245, 247, 0.55);
    }
  </style>
</head>
<body>
  <header>
    <div class="header-inner">
      <div class="brand-row">
        <div class="logo-circle">SC</div>
        <h1>SipCal</h1>
      </div>
      <p>Instant calorie estimates for wine, beer, and spirits – calculated from ABV, volume, and style.</p>
      <div class="pill">
        <span>⚡ No login · Free · Runs entirely in your browser</span>
      </div>
    </div>
  </header>

  <main>
    <div class="main-inner">
      <!-- Left panel: explanation -->
      <section class="panel panel--text">
        <h2>How the estimate works.</h2>
        <p>
          SipCal uses simple, transparent math. You enter alcohol by volume (ABV),
          how much you are drinking, and how sweet it is. We convert that into an
          estimate of calories from alcohol plus a small adjustment for sugar.
        </p>

        <div class="hero-list">
          <div class="hero-item">
            <div class="hero-dot"></div>
            <div>
              <strong>Alcohol calories</strong> – 1 gram of pure alcohol is about 7&nbsp;kcal.
              We use bottle size × ABV to estimate total alcohol grams.
            </div>
          </div>
          <div class="hero-item">
            <div class="hero-dot"></div>
            <div>
              <strong>Sugar calories</strong> – Dry drinks add almost none. Off-dry and sweet
              drinks add more, so we bump the estimate accordingly.
            </div>
          </div>
          <div class="hero-item">
            <div class="hero-dot"></div>
            <div>
              <strong>Your serving size</strong> – Choose how big your glass is and how many
              servings, and we project the total.
            </div>
          </div>
        </div>

        <p class="hero-footnote">
          Barcode lookup is optional and only works for bottles that have been manually
          added to our small test database. The core estimates will always work from ABV
          and volume alone.
        </p>
      </section>

      <!-- Right panel: calculator -->
      <section class="panel">
        <div class="panel-header">
          <h3>Calorie estimator</h3>
          <div class="badge">Prototype · v0.2</div>
        </div>

        <!-- Optional barcode lookup (keeps existing API) -->
        <label for="barcode">Lookup by barcode (optional)</label>
        <div class="lookup-row">
          <input
            id="barcode"
            type="text"
            placeholder="Scan or type barcode (e.g. 1234567890123)"
          />
          <button type="button" class="btn-secondary" id="lookupButton">
            LOOKUP
          </button>
        </div>
        <div class="lookup-note">
          <span>Beta:</span> only works for a few test bottles you’ve entered in Supabase.
        </div>

        <!-- Core calculation inputs -->
        <label for="drinkType">Drink type</label>
        <select id="drinkType">
          <option value="wine">Wine</option>
          <option value="beer">Beer</option>
          <option value="spirit">Spirits</option>
          <option value="other">Other / mixed drink</option>
        </select>

        <label for="abv">Alcohol by volume (ABV %)</label>
        <input id="abv" type="number" min="0" max="100" step="0.1" placeholder="e.g. 12" />

        <div class="field-row">
          <div>
            <label for="volume">Bottle / total volume (ml)</label>
            <input
              id="volume"
              type="number"
              min="50"
              step="10"
              placeholder="e.g. 750 for a wine bottle"
            />
          </div>
          <div>
            <label for="glass">Glass size (ml)</label>
            <input
              id="glass"
              type="number"
              min="30"
              step="10"
              value="150"
            />
          </div>
        </div>

        <div class="field-row">
          <div>
            <label for="servings">Number of servings</label>
            <input
              id="servings"
              type="number"
              min="1"
              step="1"
              value="1"
            />
          </div>
          <div>
            <label for="style">Style / sweetness</label>
            <select id="style">
              <option value="dry">Dry (most table wine, light beer)</option>
              <option value="offdry">Off-dry / semi-sweet</option>
              <option value="sweet">Sweet wine, liqueur, dessert</option>
            </select>
          </div>
        </div>

        <button class="btn-primary" id="calc">
          ESTIMATE CALORIES
        </button>

        <div class="results" id="results" style="display:none;">
          <h4>Your estimate</h4>
          <p id="perGlass"></p>
          <p id="perServing"></p>
          <p id="perBottle"></p>
          <p class="tagline">
            Based on alcohol calories plus a simple sugar adjustment by style.
            Real bottles may vary, especially for very sweet or mixed drinks.
          </p>
        </div>

        <p class="hint">
          <span>Note:</span> This is a rough estimate, not medical or nutrition advice. If a
          producer provides an actual nutrition label, that label wins.
        </p>
      </section>
    </div>
  </main>

  <footer>
    © <span id="year"></span> SipCal · Prototype only – not medical or nutrition advice.
  </footer>

  <script>
    // --- Core math helpers ---------------------------------------------------

    function estimateSugarExtra(style, drinkType, volumeMl) {
      // very rough sugar bump (kcal per 100ml)
      let per100ml = 0;

      if (style === "dry") {
        if (drinkType === "beer") per100ml = 3;
        else per100ml = 0; // most dry wines/spirits very low sugar
      } else if (style === "offdry") {
        per100ml = 12; // mild sweetness
      } else if (style === "sweet") {
        per100ml = 30; // dessert-like or liqueur
      }

      return (per100ml * volumeMl) / 100;
    }

    function calculateCalories() {
      const abv = parseFloat(document.getElementById("abv").value);
      const volume = parseFloat(document.getElementById("volume").value);
      const glass = parseFloat(document.getElementById("glass").value) || 150;
      const servings = parseFloat(document.getElementById("servings").value) || 1;
      const style = document.getElementById("style").value;
      const drinkType = document.getElementById("drinkType").value;

      if (isNaN(abv) || isNaN(volume) || abv <= 0 || volume <= 0) {
        alert("Please enter a valid ABV and total volume.");
        return;
      }

      // Alcohol calories:
      // volume_ml * (abv/100) gives ml of pure alcohol.
      // 1 ml alcohol ≈ 0.789 g; 1 g alcohol ≈ 7 kcal
      const alcoholMl = volume * (abv / 100);
      const alcoholGrams = alcoholMl * 0.789;
      const alcoholCalories = alcoholGrams * 7;

      // Sugar adjustment by style + drink type
      const sugarCalories = estimateSugarExtra(style, drinkType, volume);

      const totalBottle = alcoholCalories + sugarCalories;

      // Per glass
      const perGlass = totalBottle * (glass / volume);

      // Total for chosen number of servings (each "serving" = one glass)
      const totalServingsCalories = perGlass * servings;

      const results = document.getElementById("results");
      document.getElementById(
        "perGlass"
      ).textContent = `Per ${glass.toFixed(0)} ml glass: ~${perGlass.toFixed(0)} kcal`;

      document.getElementById(
        "perServing"
      ).textContent = `For ${servings.toFixed(0)} glass${servings > 1 ? "es" : ""}: ~${totalServingsCalories.toFixed(0)} kcal`;

      document.getElementById(
        "perBottle"
      ).textContent = `Per ${volume.toFixed(0)} ml bottle / total volume: ~${totalBottle.toFixed(0)} kcal`;

      results.style.display = "block";
    }

    // --- Supabase-backed barcode lookup (kept as-is, optional) --------------

    async function lookupByBarcode() {
      const barcode = document.getElementById("barcode").value.trim();
      if (!barcode) {
        alert("Enter a barcode first.");
        return;
      }

      try {
        const res = await fetch(`/api/lookup?barcode=${encodeURIComponent(barcode)}`);
        if (!res.ok) {
          if (res.status === 404) {
            alert("Product not found in the test database yet.");
            return;
          }
          alert("Error looking up product.");
          return;
        }

        const data = await res.json();
        const product = data.product;
        if (!product) {
          alert("No product data returned from the API.");
          return;
        }

        // Fill in known fields
        if (product.abv != null) {
          document.getElementById("abv").value = product.abv;
        }
        if (product.style) {
          document.getElementById("style").value = product.style;
        }
        if (product.category) {
          document.getElementById("drinkType").value = product.category;
        }

        // If you stored calories_bottle, we can use it directly
        if (product.calories_bottle && product.calories_bottle > 0) {
          const volumeInput = document.getElementById("volume");
          const glassInput = document.getElementById("glass");

          const volume =
            parseFloat(volumeInput.value) || 750; // assume 750ml if blank
          const glass = parseFloat(glassInput.value) || 150;

          const totalBottle = product.calories_bottle;
          const perGlass = totalBottle * (glass / volume);
          const servings =
            parseFloat(document.getElementById("servings").value) || 1;
          const totalServingsCalories = perGlass * servings;

          const results = document.getElementById("results");
          document.getElementById(
            "perGlass"
          ).textContent = `Per ${glass.toFixed(0)} ml glass: ~${perGlass.toFixed(0)} kcal`;
          document.getElementById(
            "perServing"
          ).textContent = `For ${servings.toFixed(0)} glass${servings > 1 ? "es" : ""}: ~${totalServingsCalories.toFixed(0)} kcal`;
          document.getElementById(
            "perBottle"
          ).textContent = `Per ${volume.toFixed(0)} ml bottle / total volume: ~${totalBottle.toFixed(0)} kcal`;
          results.style.display = "block";

          alert("Product found – using stored calories for this bottle.");
        } else {
          alert(
            "Product found – ABV/style filled. Now choose volume/glass size and press ESTIMATE."
          );
        }
      } catch (e) {
        console.error(e);
        alert("Unexpected error looking up barcode.");
      }
    }

    // --- Wire up events ------------------------------------------------------

    document.getElementById("year").textContent = new Date().getFullYear();
    document.getElementById("calc").addEventListener("click", calculateCalories);
    document
      .getElementById("lookupButton")
      .addEventListener("click", lookupByBarcode);
  </script>
</body>
</html>
